{% extends 'base.html' %}
{% block content %}
<style>
  /* Spacing between controls and results */
  .tech-shell {
    display: flex;
    flex-direction: column;
    gap: 2.5rem;
  }

  .tech-controls-card {
    margin-bottom: 1rem;
  }

  .tech-results-card {
    margin-top: 1rem;
  }

  /* Table styling like websites */
  :root {
    --ts-table-header-bg-dark: rgba(15, 23, 42, 0.9);
  }

  #ts-table thead th {
    position: sticky;
    top: 0;
    background: var(--ts-table-header-bg-dark);
    z-index: 5;
    font-size: 0.68rem;
    transition: all 0.25s ease;
  }

  #ts-table thead th.sortable {
    cursor: pointer;
    user-select: none;
    transition: background-color 0.25s ease;
  }

  #ts-table thead th.sortable:hover {
    background: rgba(255, 255, 255, 0.08);
  }

  #ts-table thead th.sortable:after {
    content: '\25B4';
    opacity: 0;
    font-size: .55rem;
    margin-left: 4px;
    transition: opacity 0.25s ease, transform 0.25s ease;
  }

  #ts-table thead th.sortable.sorted-asc:after {
    content: '\25B4';
    opacity: .85;
    transform: translateY(-1px);
  }

  #ts-table thead th.sortable.sorted-desc:after {
    content: '\25BE';
    opacity: .85;
    transform: translateY(1px);
  }

  #ts-table tbody tr {
    transition: all 0.25s ease;
  }

  #ts-table tbody tr:hover {
    transform: translateX(4px);
    box-shadow: -4px 0 0 rgba(96, 165, 250, 0.5);
    background: rgba(255, 255, 255, 0.08);
  }

  .table-shadow {
    box-shadow: 0 6px 8px -6px rgba(0, 0, 0, .55);
  }

  /* Pagination styling */
  #paging-bar {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
    margin-top: .9rem;
    font-size: 0.6rem;
  }

  .pg-box {
    display: flex;
    align-items: center;
    gap: .5rem;
    background: var(--ts-input-bg);
    border: 1px solid var(--ts-input-border);
    padding: 6px 10px;
    border-radius: 10px;
    height: 38px;
    transition: all 0.25s ease;
  }

  .pg-box select {
    background: var(--ts-input-bg);
    border: 1px solid var(--ts-input-border);
    color: var(--ts-text);
    font-size: 0.6rem;
    padding: 3px 6px;
    border-radius: 6px;
    height: 26px;
    line-height: 1;
    transition: all 0.2s ease;
  }

  .pg-nav {
    display: flex;
    align-items: center;
    gap: .4rem;
  }

  .pg-btn {
    font-size: .55rem;
    padding: 3px 10px;
    min-width: 36px;
    height: 26px;
    line-height: 1;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    transition: all 0.25s cubic-bezier(0.22, 0.72, 0.18, 0.99);
  }

  .pg-info {
    min-width: 120px;
    text-align: center;
    font-size: 0.6rem;
  }

  .pg-btn[disabled] {
    opacity: .4;
    cursor: not-allowed;
  }

  .pg-btn:not([disabled]) {
    border-color: var(--glass-border-strong);
  }

  .pg-btn:not([disabled]):hover {
    background: rgba(255, 255, 255, 0.06);
    transform: translateY(-1px);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
  }

  tbody.page-fade {
    animation: pageFade .35s cubic-bezier(0.22, 0.72, 0.18, 0.99);
  }

  @keyframes pageFade {
    from {
      opacity: 0;
      transform: translateY(8px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Aesthetic scrollbar */
  .table-shadow::-webkit-scrollbar,
  #ts-suggest::-webkit-scrollbar,
  #cat-suggest::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }

  .table-shadow::-webkit-scrollbar-thumb,
  #ts-suggest::-webkit-scrollbar-thumb,
  #cat-suggest::-webkit-scrollbar-thumb {
    background: rgba(148, 163, 184, 0.35);
    border-radius: 999px;
  }

  .table-shadow::-webkit-scrollbar-track,
  #ts-suggest::-webkit-scrollbar-track,
  #cat-suggest::-webkit-scrollbar-track {
    background: rgba(15, 23, 42, 0.25);
    border-radius: 999px;
  }

  /* Light mode overrides */
  body.light #ts-table thead th {
    background: rgba(248, 250, 252, 0.95) !important;
    color: #334155;
  }

  body.light #ts-table thead th.sortable:hover {
    background: rgba(0, 0, 0, 0.04) !important;
  }

  body.light #ts-table tbody tr:hover {
    background: rgba(59, 130, 246, 0.06);
    box-shadow: -4px 0 0 rgba(59, 130, 246, 0.4);
  }

  body.light .pg-box {
    background: #ffffff;
    border-color: #e2e8f0;
  }

  body.light .pg-box select {
    background: #ffffff;
    border-color: #d1d5db;
    color: #1e293b;
  }

  body.light .pg-btn:not([disabled]):hover {
    background: rgba(0, 0, 0, 0.04);
  }

  body.light .table-shadow::-webkit-scrollbar-thumb,
  body.light #ts-suggest::-webkit-scrollbar-thumb,
  body.light #cat-suggest::-webkit-scrollbar-thumb {
    background: rgba(100, 116, 139, 0.35);
  }

  body.light .table-shadow::-webkit-scrollbar-track,
  body.light #ts-suggest::-webkit-scrollbar-track,
  body.light #cat-suggest::-webkit-scrollbar-track {
    background: rgba(241, 245, 249, 0.5);
  }
</style>
<div class="page-wrapper tech-shell">
  <div class="page-centered glass-card tech-controls-card">
    <h2 class="page-title">Technology Search</h2>
    <form id="tech-form" class="controls-row" autocomplete="off">
      <div class="search-col search-col--primary" style="position:relative;">
        <label for="ts-tech">Technology</label>
        <input id="ts-tech" name="tech" type="text" placeholder="WordPress" autocomplete="off" />
        <div id="ts-suggest"
          style="display:none;position:absolute;top:100%;left:0;right:0;background:var(--glass-surf-2);border:1px solid var(--glass-border-strong);border-radius:12px;margin-top:4px;z-index:40;max-height:240px;overflow:auto;box-shadow:var(--glass-shadow-1), var(--glass-shadow-2);backdrop-filter:blur(calc(var(--glass-blur)*.55)) saturate(var(--glass-sat));-webkit-backdrop-filter:blur(calc(var(--glass-blur)*.55)) saturate(var(--glass-sat));font-size:.6rem;">
          <div class="sg-status" style="display:none;padding:8px 10px;opacity:.7;">Loading...</div>
          <div class="sg-items"></div>
        </div>
      </div>
      <div class="search-col search-col--compact" style="position:relative;">
        <label for="ts-category">Category</label>
        <input id="ts-category" name="category" type="text" placeholder="cms" autocomplete="off" />
        <div id="cat-suggest"
          style="display:none;position:absolute;top:100%;left:0;right:0;background:var(--glass-surf-2);border:1px solid var(--glass-border-strong);border-radius:12px;margin-top:4px;z-index:40;max-height:220px;overflow:auto;box-shadow:var(--glass-shadow-1), var(--glass-shadow-2);backdrop-filter:blur(calc(var(--glass-blur)*.55)) saturate(var(--glass-sat));-webkit-backdrop-filter:blur(calc(var(--glass-blur)*.55)) saturate(var(--glass-sat));font-size:.6rem;">
          <div class="cat-status" style="display:none;padding:6px 8px;opacity:.7;">Loading...</div>
          <div class="cat-items"></div>
        </div>
      </div>
      <div class="search-col search-col--compact">
        <label for="ts-version">Version</label>
        <input id="ts-version" name="version" type="text" placeholder="6.5.3" />
      </div>
      <div class="right-col">
        <button id="ts-submit" class="secondary" type="submit" aria-label="Search" title="Search">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="7"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          </svg>
        </button>
      </div>
    </form>
    <div class="summary-line">
      <small id="ts-summary" class="mono">Enter a query and press Search.</small>
    </div>
  </div>
  <div class="page-centered glass-card tech-results-card" id="ts-results-wrap">
    <div class="table-shadow" style="overflow:auto;max-height:60vh;">
      <div class="table-loading" id="ts-loading">Loading...</div>
      <table id="ts-table" class="table-glass table-glass--compact">
        <thead>
          <tr>
            <th style="width:34px;">#</th>
            <th class="sortable" data-sort="domain">Domain</th>
            <th class="sortable" data-sort="tech_name">Technology</th>
            <th>Version</th>
            <th>Category</th>
            <th class="sortable" data-sort="first_seen">First Seen</th>
            <th class="sortable" data-sort="last_seen">Last Seen</th>
          </tr>
        </thead>
        <tbody id="ts-tbody">
          <tr>
            <td colspan="7" id="ts-empty">
              <div class="ts-empty-panel">
                <div class="ts-empty-title">Nothing to show yet</div>
                <div class="ts-empty-hint">Use the filters above, then hit Search.</div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div id="paging-bar" class="small" style="display:none;">
      <div class="pg-box">
        <label for="page-size" style="margin:0;opacity:.75;">Show</label>
        <select id="page-size">
          <option value="10">10</option>
          <option value="20" selected>20</option>
          <option value="50">50</option>
          <option value="100">100</option>
        </select>
      </div>
      <div class="pg-box pg-nav">
        <button id="page-first" class="secondary outline pg-btn" disabled>&laquo;</button>
        <button id="page-prev" class="secondary outline pg-btn" disabled>&lt;</button>
        <span id="page-info" class="pg-info">Page 1/1</span>
        <button id="page-next" class="secondary outline pg-btn" disabled>&gt;</button>
        <button id="page-last" class="secondary outline pg-btn" disabled>&raquo;</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}
{% block scripts %}
<script src="{{ url_for('static', filename='js/tech_search.js') }}"></script>
{% endblock %}