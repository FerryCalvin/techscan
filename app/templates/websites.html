{% extends 'base.html' %}
{% block content %}
<div class="page-wrapper">
  <div class="page-centered glass-card compact websites-card">
    <style>
      #paging-bar {
        display: flex;
        align-items: center;
        gap: 1rem;
        flex-wrap: wrap;
        margin-top: .9rem;
        font-size: 0.6rem;
      }

      .pg-box {
        display: flex;
        align-items: center;
        gap: .5rem;
        background: var(--ts-input-bg);
        border: 1px solid var(--ts-input-border);
        padding: 6px 10px;
        border-radius: 10px;
        height: 38px;
        transition: all 0.25s ease;
      }

      .pg-box select {
        background: var(--ts-input-bg);
        border: 1px solid var(--ts-input-border);
        color: var(--ts-text);
        font-size: 0.6rem;
        padding: 3px 6px;
        border-radius: 6px;
        height: 26px;
        line-height: 1;
        transition: all 0.2s ease;
      }

      .pg-nav {
        display: flex;
        align-items: center;
        gap: .4rem;
      }

      .pg-btn {
        font-size: .55rem;
        padding: 3px 10px;
        min-width: 36px;
        height: 26px;
        line-height: 1;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: all 0.25s cubic-bezier(0.22, 0.72, 0.18, 0.99);
      }

      .pg-info {
        min-width: 120px;
        text-align: center;
        font-size: 0.6rem;
      }

      .pg-btn[disabled] {
        opacity: .4;
        cursor: not-allowed;
      }

      .pg-btn:not([disabled]) {
        border-color: var(--glass-border-strong);
      }

      .pg-btn:not([disabled]):hover {
        background: rgba(255, 255, 255, 0.06);
        transform: translateY(-1px);
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
      }

      .pg-btn:not([disabled]):active {
        transform: translateY(0);
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      td .actions .del-btn svg {
        transform: translateY(-2px);
      }

      /* lifted a bit more for visual centering */
      tbody.page-fade {
        animation: pageFade .35s cubic-bezier(0.22, 0.72, 0.18, 0.99);
      }

      @keyframes pageFade {
        from {
          opacity: 0;
          transform: translateY(8px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @media (max-width:680px) {
        #paging-bar {
          gap: .6rem;
        }

        .pg-box {
          height: auto;
          padding: 6px 8px;
        }

        .pg-info {
          min-width: 100px;
        }
      }

      .page-centered {
        max-width: 1200px;
        margin: 0 auto;
      }

      .page-centered h2.page-title {
        margin-top: 0;
        margin-bottom: .9rem;
        display: block;
        text-align: center;
      }

      .controls-row {
        display: flex;
        align-items: flex-end;
        gap: 1rem;
        justify-content: space-between;
        flex-wrap: wrap;
        margin-bottom: .35rem;
      }

      .websites-card {
        margin-bottom: 0.9rem;
      }

      .websites-table-card {
        margin-top: 0;
      }

      .websites-table-card #bulk-table-wrapper {
        margin-top: 0.4rem;
      }

      .websites-table-card #paging-bar {
        margin-top: 0.6rem;
      }

      .search-col {
        flex: 1 1 640px;
        min-width: 360px;
        display: flex;
        flex-direction: column;
        gap: .25rem;
      }

      .control-std {
        height: 32px;
        box-sizing: border-box;
        border: 1px solid var(--ts-input-border);
        background: var(--ts-input-bg);
        font-size: 0.65rem;
        line-height: 1.0;
        padding: 0 .65rem;
        display: inline-flex;
        align-items: center;
        transition: all 0.25s ease;
      }

      .search-col input {
        width: 100%;
        font-size: 0.65rem;
        padding: 0 .65rem;
        line-height: 1.0;
        height: 32px;
        box-sizing: border-box;
        border: 1px solid var(--ts-input-border);
        background: var(--ts-input-bg);
        color: #f8fafc;
        transition: all 0.25s ease;
      }

      .search-col input:focus {
        outline: 2px solid var(--ts-accent);
        outline-offset: 2px;
        transform: scale(1.01);
      }

      .search-col input::placeholder {
        font-size: 0.65rem;
        opacity: .7;
      }

      .right-col {
        display: flex;
        align-items: flex-end;
        gap: .65rem;
        position: relative;
      }

      .right-col .manage-groups-col {
        display: flex;
        flex-direction: column;
        gap: .25rem;
      }

      .right-col .group-filter-col {
        display: flex;
        flex-direction: column;
        gap: .25rem;
        line-height: 1.05;
      }

      #group-filter {
        font-size: 0.65rem;
        padding: 0 .55rem;
        height: 32px;
        line-height: 32px;
        box-sizing: border-box;
        border: 1px solid var(--ts-input-border);
        background: var(--ts-input-bg);
        display: inline-flex;
        align-items: center;
        transition: all 0.25s ease;
      }

      #group-filter:focus {
        outline: 2px solid var(--ts-accent);
        outline-offset: 2px;
      }

      /* Unified control vertical rhythm */
      .search-col label,
      .group-filter-col label,
      .manage-groups-col label {
        display: block;
        margin: 0 0 .25rem;
        line-height: 1.1;
      }

      #manage-groups-open {
        padding: 0;
        line-height: 1;
        border-radius: 6px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 34px;
        height: 32px;
        margin-top: 0;
        margin-bottom: 0rem;
        align-self: flex-end;
        background: var(--ts-input-bg);
        border: 1px solid var(--ts-input-border);
        transition: all 0.25s cubic-bezier(0.22, 0.72, 0.18, 0.99);
      }

      #manage-groups-open svg {
        width: 16px;
        height: 16px;
        stroke: #d7dde2;
        stroke-width: 1.4;
        transform: translateY(0px);
        transition: all 0.25s ease;
      }

      .sr-only {
        position: absolute !important;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0 0 0 0);
        white-space: nowrap;
        border: 0;
      }

      #manage-groups-open:hover {
        background: rgba(255, 255, 255, 0.06);
        border-color: var(--glass-border-strong);
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      #manage-groups-open:active {
        transform: translateY(0);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
      }

      #manage-groups-open:focus {
        outline: 2px solid var(--ts-accent);
        outline-offset: 2px;
      }

      #manage-groups-open.open {
        background: rgba(255, 255, 255, 0.08);
        border-color: var(--glass-border-strong);
      }

      #manage-groups-open:after {
        content: '';
      }

      .grp-popover {
        position: absolute;
        top: 100%;
        right: 0;
        margin-top: 6px;
        min-width: 260px;
        background: var(--glass-surf-2);
        border: 1px solid var(--glass-border-strong);
        border-radius: 12px;
        padding: .7rem .75rem .8rem;
        box-shadow: var(--glass-shadow-1), var(--glass-shadow-2);
        z-index: 30;
        font-size: 0.65rem;
        backdrop-filter: blur(calc(var(--glass-blur)*.6)) saturate(var(--glass-sat));
        -webkit-backdrop-filter: blur(calc(var(--glass-blur)*.6)) saturate(var(--glass-sat));
      }

      .grp-popover:before {
        content: '';
        position: absolute;
        top: -6px;
        right: 14px;
        width: 10px;
        height: 10px;
        background: var(--glass-surf-2);
        border-left: 1px solid var(--glass-border-strong);
        border-top: 1px solid var(--glass-border-strong);
        transform: rotate(45deg);
      }

      .grp-popover h6 {
        margin: .1rem 0 .4rem;
        font-size: 0.65rem;
        letter-spacing: .5px;
        text-transform: uppercase;
        opacity: .8;
      }

      .grp-popover.horizontal {
        display: flex;
        flex-direction: row;
        gap: 1rem;
        min-width: 560px;
        max-width: 800px;
      }

      .grp-popover .grp-controls {
        flex: 0 0 220px;
        display: flex;
        flex-direction: column;
        gap: .55rem;
      }

      .grp-popover .gp-add {
        display: flex;
        gap: .4rem;
      }

      .grp-popover .gp-add input {
        flex: 1 1 auto;
        font-size: 0.6rem;
        padding: .36rem .5rem;
        height: 32px;
        box-sizing: border-box;
      }

      .grp-popover .gp-add button {
        font-size: 0.55rem;
        padding: 2px 6px;
        height: 32px;
      }

      /* Group list: fixed max height and internal scroll only. Touch-friendly and with light custom scrollbars. */
      .grp-popover {
        max-height: calc(100vh - 120px);
        overflow: visible;
      }

      /* ensure popover doesn't exceed viewport, list will scroll */
      .grp-popover #group-list {
        flex: 1 1 320px;
        max-height: 260px;
        overflow: auto;
        border-left: 1px solid var(--glass-border-strong);
        padding-left: .6rem;
        margin-left: .4rem;
        padding-top: .15rem;
        padding-bottom: .15rem;
        border-radius: 6px;
      }

      .grp-popover #group-list {
        -webkit-overflow-scrolling: touch;
        scrollbar-width: thin;
        scrollbar-color: rgba(120, 130, 140, 0.32) transparent;
      }

      .grp-popover #group-list::-webkit-scrollbar {
        width: 10px;
        height: 10px
      }

      .grp-popover #group-list::-webkit-scrollbar-thumb {
        background: rgba(120, 130, 140, 0.28);
        border-radius: 8px;
        border: 2px solid transparent;
        background-clip: padding-box
      }

      body.light .grp-popover #group-list::-webkit-scrollbar-thumb {
        background: rgba(80, 90, 100, 0.16)
      }

      .grp-popover #group-list .x-del {
        font-size: .5rem;
        padding: 2px 5px;
      }

      .grp-popover .empty {
        opacity: .5;
      }

      /* Popover animation - enhanced smooth transitions */
      .grp-popover {
        opacity: 0;
        transform: translateY(-8px) scale(0.95);
        transition: opacity 0.25s cubic-bezier(0.22, 0.72, 0.18, 0.99), transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
      }

      .grp-popover.show {
        opacity: 1;
        transform: translateY(0) scale(1);
      }

      /* stronger elevation when moved to body (avoid being visually hidden by glass panel) */
      .grp-popover {
        pointer-events: auto;
      }

      .grp-popover[style*="position: absolute"] {
        box-shadow: 0 18px 50px -12px rgba(10, 20, 40, 0.7), 0 6px 20px -12px rgba(30, 60, 100, 0.35);
      }

      /* Toast notifications - enhanced slide-in animation */
      #toast-stack {
        position: fixed;
        bottom: 14px;
        right: 14px;
        display: flex;
        flex-direction: column;
        gap: .55rem;
        z-index: 120;
      }

      .toast {
        background: var(--glass-surf-2);
        border: 1px solid var(--glass-border-strong);
        padding: .55rem .75rem;
        border-radius: 16px;
        font-size: 0.6rem;
        line-height: 1.15;
        display: flex;
        align-items: center;
        gap: .65rem;
        box-shadow: var(--glass-shadow-1), var(--glass-shadow-2);
        max-width: 260px;
        backdrop-filter: blur(calc(var(--glass-blur)*.5)) saturate(var(--glass-sat));
        -webkit-backdrop-filter: blur(calc(var(--glass-blur)*.5)) saturate(var(--glass-sat));
        animation: toastSlideIn 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
        transition: all 0.25s ease;
      }

      @keyframes toastSlideIn {
        from {
          opacity: 0;
          transform: translateX(100%) translateY(20px) scale(0.8);
        }

        to {
          opacity: 1;
          transform: translateX(0) translateY(0) scale(1);
        }
      }

      .toast:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.35);
      }

      .toast.ok {
        border-color: var(--ts-success);
      }

      .toast.err {
        border-color: var(--ts-danger);
      }

      .toast .close {
        background: none;
        border: none;
        color: #88939d;
        cursor: pointer;
        font-size: .75rem;
        padding: 0 4px;
        transition: all 0.2s ease;
      }

      .toast .close:hover {
        color: #fff;
        transform: scale(1.2);
      }

      /* Diff badges improved with smooth transitions */
      .badge.diff-added {
        background: linear-gradient(145deg, hsla(145, 55%, 28%, 0.55), hsla(145, 55%, 22%, 0.35));
        color: #8dff8d;
        border: 1px solid hsla(145, 70%, 45%, 0.55);
        backdrop-filter: blur(6px) saturate(160%);
        -webkit-backdrop-filter: blur(6px) saturate(160%);
        transition: all 0.25s ease;
      }

      .badge.diff-added:hover {
        transform: scale(1.08);
        box-shadow: 0 2px 8px hsla(145, 70%, 45%, 0.4);
      }

      .badge.diff-removed {
        background: linear-gradient(145deg, hsla(350, 60%, 30%, 0.55), hsla(350, 60%, 22%, 0.35));
        color: #ff9e9e;
        border: 1px solid hsla(350, 70%, 55%, 0.55);
        backdrop-filter: blur(6px) saturate(160%);
        -webkit-backdrop-filter: blur(6px) saturate(160%);
        transition: all 0.25s ease;
      }

      .badge.diff-removed:hover {
        transform: scale(1.08);
        box-shadow: 0 2px 8px hsla(350, 70%, 55%, 0.4);
      }

      .badge.diff-changed {
        background: linear-gradient(145deg, hsla(35, 80%, 34%, 0.55), hsla(35, 80%, 26%, 0.35));
        color: #ffc777;
        border: 1px solid hsla(35, 85%, 55%, 0.55);
        backdrop-filter: blur(6px) saturate(160%);
        -webkit-backdrop-filter: blur(6px) saturate(160%);
        transition: all 0.25s ease;
      }

      .badge.diff-changed:hover {
        transform: scale(1.08);
        box-shadow: 0 2px 8px hsla(35, 85%, 55%, 0.4);
      }

      td .badge {
        margin-right: 2px;
      }

      /* Action buttons unified alignment with smooth transitions */
      td .assign-btn,
      td .actions .del-btn {
        height: 26px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        line-height: 1;
        padding: 0 6px;
        transition: all 0.25s cubic-bezier(0.22, 0.72, 0.18, 0.99);
      }

      td .assign-btn:hover,
      td .actions .del-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      td .assign-btn:active,
      td .actions .del-btn:active {
        transform: translateY(0);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
      }

      td .actions {
        display: flex;
        align-items: center;
      }

      mark.hl {
        background: var(--ts-highlight-bg);
        color: #fff;
        padding: 0 2px;
        border-radius: 3px;
        transition: all 0.2s ease;
      }

      mark.hl:hover {
        background: var(--ts-accent);
        color: #fff;
      }

      /* Sticky header + sorting with smooth transitions */
      :root {
        --ts-table-header-bg-dark: rgba(15, 23, 42, 0.9);
      }

      /* Allow stronger dark header for improved contrast */
      #domains-table thead th {
        position: sticky;
        top: 0;
        background: var(--ts-table-header-bg-dark);
        z-index: 5;
        font-size: 0.68rem;
        transition: all 0.25s ease;
      }

      #domains-table thead th.sortable {
        cursor: pointer;
        user-select: none;
        transition: background-color 0.25s ease;
      }

      #domains-table thead th.sortable:hover {
        background: rgba(255, 255, 255, 0.08);
      }

      #domains-table thead th.sortable:after {
        content: '\25B4';
        opacity: 0;
        font-size: .55rem;
        margin-left: 4px;
        transition: opacity 0.25s ease, transform 0.25s ease;
      }

      #domains-table thead th.sortable.sorted-asc:after {
        content: '\25B4';
        opacity: .85;
        transform: translateY(-1px);
      }

      #domains-table thead th.sortable.sorted-desc:after {
        content: '\25BE';
        opacity: .85;
        transform: translateY(1px);
      }

      /* Enhanced table row hover animation */
      #domains-table tbody tr {
        transition: all 0.25s ease;
      }

      #domains-table tbody tr:hover {
        transform: translateX(4px);
        box-shadow: -4px 0 0 rgba(96, 165, 250, 0.5);
        background: rgba(255, 255, 255, 0.08);
      }

      .table-shadow {
        box-shadow: 0 6px 8px -6px rgba(0, 0, 0, .55);
      }

      .summary-line {
        min-height: 1.1em;
        margin-bottom: .6rem;
        display: flex;
        justify-content: flex-start;
      }

      .summary-line small {
        font-size: 0.65rem;
        opacity: .85;
      }

      @media (max-width:760px) {
        .controls-row {
          flex-direction: column;
          align-items: stretch;
        }

        .right-col {
          align-self: stretch;
          justify-content: space-between;
        }

        #manage-groups-open {
          margin-top: 0;
        }

        .search-col {
          flex: 1 1 auto;
        }
      }
    </style>
    <style>
      /* Light mode overrides (phase 1) */
      body.light #domains-table thead th {
        background: var(--ts-table-header-bg-light);
        color: #374151;
        border-bottom: 1px solid var(--ts-table-border-light);
      }

      body.light #domains-table thead th.sortable:hover {
        background: rgba(0, 0, 0, 0.05);
      }

      body.light #domains-table tbody tr {
        background: #ffffff;
      }

      body.light #domains-table tbody tr:nth-child(even) {
        background: var(--ts-table-row-alt-light);
      }

      body.light #domains-table tbody tr:hover {
        background: var(--ts-table-row-hover-light);
        box-shadow: -4px 0 0 rgba(37, 99, 235, 0.5);
      }

      body.light #domains-table thead th.sortable:after {
        color: #6b7280;
      }

      body.light #domains-table thead th.sortable.sorted-asc:after,
      body.light #domains-table thead th.sortable.sorted-desc:after {
        color: #374151;
      }

      body.light .pg-box {
        background: #ffffff;
        border: 1px solid #e2e8f0;
      }

      body.light .pg-btn {
        background: #ffffff;
        border: 1px solid #d1d5db;
      }

      body.light .pg-btn:not([disabled]):hover {
        background: #f1f5f9;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      }

      body.light #manage-groups-open {
        background: #ffffff;
        border: 1px solid #d1d5db;
      }

      body.light #manage-groups-open:hover {
        background: #f3f4f6;
        border-color: #cbd5e1;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      }

      body.light .grp-popover {
        background: #ffffff;
        border: 1px solid #e2e8f0;
        box-shadow: 0 6px 20px -6px rgba(0, 0, 0, 0.15);
      }

      body.light .grp-popover:before {
        background: #ffffff;
        border-color: #e2e8f0;
      }

      body.light .toast {
        background: #ffffff;
        border: 1px solid #e5e7eb;
      }

      body.light .toast:hover {
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
      }

      body.light .toast.ok {
        border-color: #4ade80;
      }

      body.light .toast.err {
        border-color: #fca5a5;
      }

      body.light .badge.diff-added {
        background: #e6f9ed;
        color: #047857;
      }

      body.light .badge.diff-added:hover {
        box-shadow: 0 2px 8px rgba(4, 120, 87, 0.3);
      }

      body.light .badge.diff-removed {
        background: #fde8e8;
        color: #b91c1c;
      }

      body.light .badge.diff-removed:hover {
        box-shadow: 0 2px 8px rgba(185, 28, 28, 0.3);
      }

      body.light .badge.diff-changed {
        background: #fff4e5;
        color: #b45309;
      }

      body.light .badge.diff-changed:hover {
        box-shadow: 0 2px 8px rgba(180, 83, 9, 0.3);
      }

      body.light #multi-toolbar {
        background: rgba(255, 255, 255, 0.92);
        border-color: #dce3eb;
        box-shadow: 0 4px 14px -4px rgba(0, 0, 0, 0.15);
      }

      body.light #multi-toolbar button {
        background: #ffffff;
        border: 1px solid #d1d5db;
      }

      body.light #multi-toolbar button:hover {
        background: #f3f4f6;
      }

      body.light mark.hl {
        background: #e0e7ff;
        color: #1e3a8a;
      }

      body.light mark.hl:hover {
        background: #c7d2fe;
        color: #1e3a8a;
      }

      /* Light mode - Input fields */
      body.light .search-col input {
        background: #ffffff;
        border-color: #d1d5db;
        color: #1e293b;
      }

      body.light .search-col input::placeholder {
        color: #9ca3af;
      }

      body.light .search-col input:focus {
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
      }

      /* Light mode - Control elements */
      body.light .control-std,
      body.light #group-filter {
        background: #ffffff;
        border-color: #d1d5db;
        color: #1e293b;
      }

      body.light .pg-box {
        background: #ffffff;
        border-color: #e2e8f0;
      }

      body.light .pg-box select {
        background: #ffffff;
        border-color: #d1d5db;
        color: #1e293b;
      }

      /* Light mode - Glass card */
      body.light .glass-card {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(248, 250, 252, 0.85));
        border-color: rgba(203, 213, 225, 0.5);
        box-shadow: 0 4px 15px -4px rgba(0, 0, 0, 0.1);
      }

      /* Light mode - Labels */
      body.light label {
        color: #374151;
      }

      /* body.light .page-title - removed to allow gradient from base.html */

      body.light .summary-line small {
        color: #4b5563;
      }

      /* Light mode - Popover */
      body.light .grp-popover {
        background: #ffffff;
        border-color: #e2e8f0;
        box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.15);
      }

      body.light .grp-popover:before {
        background: #ffffff;
        border-color: #e2e8f0;
      }

      body.light .grp-popover input {
        background: #ffffff;
        border: 1px solid #d1d5db;
        color: #1e293b;
      }
    </style>
    <style>
      /* Liquid glass detail dialog */
      #detail-dialog {
        border: none;
        padding: 0;
        background: transparent;
      }

      #detail-dialog::backdrop {
        background: rgba(7, 11, 27, 0.65);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
      }

      .detail-panel {
        position: relative;
        margin: 4vh auto;
        max-width: 960px;
        width: calc(100vw - 2.5rem);
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.85), rgba(30, 64, 175, 0.35));
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 28px;
        padding: 1.5rem;
        box-shadow: 0 25px 60px -25px rgba(3, 7, 18, 0.9);
        color: #f8fafc;
        overflow: hidden;
      }

      body.light .detail-panel {
        background: rgba(248, 250, 252, 0.95);
        color: #0f172a;
        border-color: rgba(14, 116, 144, 0.12);
      }

      .detail-header {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: 1rem;
        margin-bottom: 1.25rem;
        flex-wrap: wrap;
      }

      .detail-label {
        font-size: 0.65rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        opacity: 0.65;
        margin: 0 0 0.15rem;
      }

      .detail-subtitle {
        margin: 0.25rem 0 0;
        font-size: 0.75rem;
        opacity: 0.75;
      }

      .detail-subtitle a {
        color: #60a5fa;
        text-decoration: none;
        font-weight: 600;
      }

      .detail-subtitle a:hover {
        text-decoration: underline;
      }

      body.light .detail-subtitle a {
        color: #2563eb;
      }

      .detail-actions {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        flex-wrap: wrap;
      }

      .detail-actions .ghost.icon {
        width: 38px;
        height: 38px;
        border-radius: 999px;
        font-size: 1.15rem;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.15);
        cursor: pointer;
        transition: all 0.2s ease;
        color: inherit;
      }

      .detail-actions .ghost.icon:hover {
        background: rgba(255, 255, 255, 0.12);
        transform: translateY(-2px);
      }

      .detail-meta-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 0.85rem;
        margin-bottom: 1.5rem;
      }

      .detail-metric {
        background: rgba(15, 23, 42, 0.4);
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: 18px;
        padding: 0.85rem 1rem;
        min-height: 110px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.08);
      }

      body.light .detail-metric {
        background: rgba(255, 255, 255, 0.9);
        border-color: rgba(15, 23, 42, 0.08);
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6);
      }

      .meta-label {
        font-size: 0.7rem;
        letter-spacing: 0.05em;
        text-transform: uppercase;
        opacity: 0.65;
        margin-bottom: 0.2rem;
      }

      .meta-value {
        font-size: 1.35rem;
        font-weight: 700;
        line-height: 1.2;
      }

      .meta-hint {
        font-size: 0.7rem;
        opacity: 0.7;
        margin-top: 0.3rem;
        display: block;
      }

      .detail-section {
        margin-bottom: 1.6rem;
        position: relative;
      }

      .section-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
        margin-bottom: 0.6rem;
      }

      .detail-table-wrapper {
        max-height: 320px;
        overflow: auto;
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        background: rgba(7, 13, 32, 0.35);
      }

      body.light .detail-table-wrapper {
        background: rgba(248, 250, 252, 0.85);
        border-color: rgba(15, 23, 42, 0.08);
      }

      #detail-tech-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        font-size: 0.75rem;
      }

      #detail-tech-table thead th {
        position: sticky;
        top: 0;
        background: rgba(15, 23, 42, 0.8);
        backdrop-filter: blur(4px);
        -webkit-backdrop-filter: blur(4px);
        font-size: 0.7rem;
        padding: 0.55rem 0.75rem;
        text-align: left;
      }

      body.light #detail-tech-table thead th {
        background: rgba(241, 245, 249, 0.95);
        color: #0f172a;
      }

      #detail-tech-table tbody td {
        padding: 0.55rem 0.75rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
      }

      body.light #detail-tech-table tbody td {
        border-color: rgba(15, 23, 42, 0.06);
      }

      .detail-diff-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 1rem;
      }

      .diff-list {
        list-style: none;
        padding: 0;
        margin: 0;
        display: flex;
        flex-direction: column;
        gap: 0.35rem;
        font-size: 0.75rem;
        max-height: 180px;
        overflow: auto;
      }

      .diff-list li {
        padding: 0.4rem 0.5rem;
        border-radius: 10px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.08);
      }

      body.light .diff-list li {
        background: rgba(248, 250, 252, 0.85);
        border-color: rgba(15, 23, 42, 0.08);
      }

      #detail-loader {
        position: absolute;
        inset: 0;
        background: rgba(6, 11, 25, 0.75);
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: inherit;
        z-index: 10;
      }

      body.light #detail-loader {
        background: rgba(15, 23, 42, 0.2);
      }

      #detail-loader .spinner {
        border-color: rgba(255, 255, 255, 0.4);
        border-top-color: #38bdf8;
      }

      @media (max-width:720px) {
        .detail-panel {
          padding: 1rem;
          border-radius: 20px;
        }

        .detail-actions {
          width: 100%;
          justify-content: flex-start;
        }

        .detail-actions .ghost.icon {
          align-self: flex-end;
          margin-left: auto;
        }
      }

      /* Evidence Modal Theming */
      :root {
        --ts-ev-bg: #1e293b;
        --ts-ev-text: #f8fafc;
        --ts-ev-border: rgba(255, 255, 255, 0.1);
        --ts-ev-item-bg: rgba(255, 255, 255, 0.05);
        --ts-ev-label: #cbd5e1;
        --ts-ev-key: #94a3b8;
        --ts-ev-val: #e2e8f0;
      }

      body.light {
        --ts-ev-bg: #ffffff;
        --ts-ev-text: #0f172a;
        --ts-ev-border: #e2e8f0;
        --ts-ev-item-bg: #f8fafc;
        --ts-ev-label: #475569;
        --ts-ev-key: #64748b;
        --ts-ev-val: #334155;
      }

      .ev-section {
        margin-bottom: 1.25rem;
      }

      .ev-section h5 {
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--ts-ev-key);
        margin-bottom: 0.5rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .ev-section h5:after {
        content: '';
        flex: 1;
        height: 1px;
        background: var(--ts-ev-border);
        opacity: 0.5;
      }

      .ev-list {
        list-style: none;
        padding: 0;
        margin: 0;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      .ev-list li {
        background: var(--ts-ev-item-bg);
        padding: 0.75rem;
        border-radius: 8px;
        border: 1px solid var(--ts-ev-border);
        font-size: 0.8rem;
      }

      .ev-obj {
        display: grid;
        grid-template-columns: minmax(60px, auto) 1fr;
        gap: 0.25rem 1rem;
        align-items: baseline;
      }

      .ev-pair {
        display: contents;
      }

      .ev-key {
        color: var(--ts-ev-key);
        font-size: 0.75rem;
        font-weight: 500;
        font-family: ui-monospace, monospace;
      }

      .ev-val {
        color: var(--ts-ev-val);
        font-family: ui-monospace, monospace;
        word-break: break-all;
      }

      .icon-btn {
        background: none;
        border: none;
        padding: 4px;
        cursor: pointer;
        color: inherit;
        opacity: 0.6;
        transition: all 0.2s;
        border-radius: 4px;
      }

      .icon-btn:hover {
        opacity: 1;
        background: rgba(125, 125, 125, 0.1);
      }

      #evidence-dialog {
        background: transparent;
        border: none;
        padding: 0;
        box-shadow: none;
      }

      #evidence-dialog::backdrop {
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(5px);
      }

      .evidence-panel {
        background: rgba(30, 41, 59, 0.85);
        backdrop-filter: blur(16px) saturate(140%);
        -webkit-backdrop-filter: blur(16px) saturate(140%);
        color: var(--ts-ev-text);
        width: 600px;
        max-width: 90vw;
        max-height: 85vh;
        border-radius: 16px;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.1);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      body.light .evidence-panel {
        background: rgba(255, 255, 255, 0.85);
        border: 1px solid rgba(255, 255, 255, 0.6);
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.5);
      }

      .ev-header {
        padding: 1rem 1.25rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: rgba(0, 0, 0, 0.15);
      }

      body.light .ev-header {
        background: rgba(255, 255, 255, 0.4);
        border-bottom-color: rgba(0, 0, 0, 0.06);
      }

      .ev-content {
        padding: 1.25rem;
        overflow-y: auto;
      }
    </style>
    <h2 class="page-title">Website List</h2>
    <div class="controls-row">
      <div class="search-col">
        <label for="filter" class="small">Domain Search</label>
        <input id="filter" placeholder="Type to filter..." />
      </div>
      <div class="right-col">
        <div class="group-filter-col">
          <label for="group-filter" class="small">Group Filter</label>
          <select id="group-filter" class="control-std">
            <option value="all">All</option>
            <option value="ungrouped">Ungrouped</option>
          </select>
        </div>
        <div class="manage-groups-col">
          <label class="sr-only">Manage Groups</label>
          <button id="manage-groups-open" class="secondary" aria-haspopup="true" aria-expanded="false"
            title="Manage Groups">
            <!-- hamburger icon -->
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <line x1="3" y1="6" x2="21" y2="6" />
              <line x1="3" y1="12" x2="21" y2="12" />
              <line x1="3" y1="18" x2="21" y2="18" />
            </svg>
          </button>
          <div id="group-popover" class="grp-popover" style="display:none;">
            <h6>Manage Groups</h6>
            <div style="display:flex;gap:1rem;align-items:flex-start;">
              <div class="grp-controls">
                <div style="display:flex;gap:.4rem;align-items:center;">
                  <input id="group-search" placeholder="search..."
                    style="flex:1 1 auto;font-size:.55rem;padding:.3rem .45rem;height:28px;" />
                  <!-- clear button reserved if needed -->
                </div>
                <div class="gp-add" style="display:flex;gap:.4rem;margin-top:.5rem;">
                  <input id="new-group" placeholder="group_name" style="font-size:.55rem;flex:1 1 auto;" />
                  <button id="add-group" class="secondary" style="height:28px;" title="Add Group">Add</button>
                </div>
                <div style="margin-top:.5rem;display:flex;justify-content:flex-end;">
                  <button id="export-all-groups" class="secondary outline"
                    style="font-size:.75rem;padding:6px 8px;">Export All</button>
                </div>
              </div>
              <div id="group-list" class="small"
                style="flex:1 1 320px;max-height:260px;overflow:auto;border-left:1px solid var(--glass-border-strong);padding-left:.6rem;margin-left:.4rem;">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="summary-line">
      <small id="summary" class="mono"></small>
    </div>
  </div>
  <div class="page-centered glass-card compact websites-card websites-table-card">
    <div id="bulk-table-wrapper" class="websites-table-wrapper" style="width:100%; display:block;">
      <table id="domains-table" class="table-glass"
        style="width:100%; font-size:0.7rem; border-collapse:separate; border-spacing:0;">
        <thead>
          <tr>
            <th style="width:34px; top:0;">#</th>
            <th style="width:26px; top:0;"><input type="checkbox" id="select-all" /></th>
            <th class="sortable" data-sort="domain" style="width:220px; top:0;">Domain</th>
            <th>Group</th>
            <th class="sortable" data-sort="tech" style="top:0;">Tech</th>
            <th class="sortable" data-sort="last_scan" style="top:0;">Last Scan</th>
            <th class="sortable" data-sort="payload" style="top:0;">Payload</th>
            <th>Mode</th>
            <th>Diff</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <div id="multi-toolbar"
      style="display:none; position:sticky; bottom:0; background:var(--glass-surf-2); backdrop-filter: blur(calc(var(--glass-blur)*.4)) saturate(var(--glass-sat)); -webkit-backdrop-filter: blur(calc(var(--glass-blur)*.4)) saturate(var(--glass-sat)); padding:.55rem .6rem; border:1px solid var(--glass-border-strong); border-radius:14px; margin-top:.85rem; display:flex; flex-wrap:wrap; gap:.5rem; align-items:center; z-index:20;">
      <span class="small" id="sel-count">0 selected</span>
      <select id="multi-group-select" style="min-width:140px;"></select>
      <button id="multi-assign" class="secondary" disabled>Assign Selected</button>
      <button id="multi-rescan" class="secondary outline" disabled>Re-Scan Selected</button>
      <button id="multi-delete" class="secondary outline" disabled>Delete Selected</button>
      <button id="multi-clear" class="secondary outline">Clear Selection</button>
      <span class="small mono" id="multi-status" style="opacity:.8;"></span>
    </div>
    <div id="paging-bar" class="small">
      <div class="pg-box">
        <label for="page-size" style="margin:0;opacity:.75;">Show</label>
        <select style="margin-top:0rem;" id="page-size">
          <option value="10">10</option>
          <option value="20" selected>20</option>
          <option value="50">50</option>
          <option value="100">100</option>
        </select>
      </div>
      <div class="pg-box pg-nav">
        <button id="page-first" class="secondary outline pg-btn" disabled>&laquo;</button>
        <button id="page-prev" class="secondary outline pg-btn" disabled>&lt;</button>
        <span id="page-info" class="pg-info">Page 1/1</span>
        <button id="page-next" class="secondary outline pg-btn" disabled>&gt;</button>
        <button id="page-last" class="secondary outline pg-btn" disabled>&raquo;</button>
      </div>
    </div>
  </div>
</div>
<div id="toast-stack" aria-live="polite"></div>
<dialog id="detail-dialog" class="liquid-dialog">
  <div class="detail-panel">
    <div class="detail-header">
      <div>
        <p class="detail-label">Domain Detail</p>
        <h3 id="detail-title">example.com</h3>
        <p id="detail-subtitle" class="detail-subtitle"></p>
      </div>
      <div class="detail-actions">
        <button id="open-domain-btn" class="secondary outline" title="Open website">Open Site</button>
        <button id="view-archived" class="secondary outline" title="Toggle best snapshot">Load Best</button>
        <button id="rescan-btn" class="contrast" title="Trigger new scan">Re-Scan</button>
        <button id="detail-close" class="ghost icon" aria-label="Close">&times;</button>
      </div>
    </div>

    <div class="detail-meta-grid">
      <div class="detail-metric">
        <span class="meta-label">Last Scan</span>
        <span class="meta-value" id="detail-last-scan">-</span>
        <small class="meta-hint" id="detail-prev-scan"></small>
      </div>
      <div class="detail-metric">
        <span class="meta-label">Mode</span>
        <span class="meta-value" id="detail-mode">-</span>
        <small class="meta-hint" id="detail-tech-count">0 technologies</small>
      </div>
      <div class="detail-metric">
        <span class="meta-label">Payload</span>
        <span class="meta-value" id="detail-payload">-</span>
        <small class="meta-hint" id="detail-status"></small>
      </div>
    </div>

    <div id="detail-loader" class="loading-overlay" style="display:none">
      <div class="spinner"></div>
    </div>

    <section class="detail-section">
      <header class="section-header">
        <h4>Technology Stack</h4>
        <span class="small" id="detail-tech-summary"></span>
      </header>
      <div class="detail-table-wrapper">
        <table id="detail-tech-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Version</th>
              <th>Categories</th>
              <th>Confidence</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <section class="detail-section detail-diff-grid">
      <article>
        <h4>Diff Added</h4>
        <ul id="diff-added" class="diff-list"></ul>
      </article>
      <article>
        <h4>Diff Removed</h4>
        <ul id="diff-removed" class="diff-list"></ul>
      </article>
    </section>

    <section class="detail-section">
      <h4>Diff Changed</h4>
      <ul id="diff-changed" class="diff-list"></ul>
    </section>
  </div>
</dialog>
<dialog id="evidence-dialog" class="liquid-dialog">
  <div class="evidence-panel">
    <div class="ev-header">
      <div>
        <div style="font-size:0.65rem; text-transform:uppercase; opacity:0.7; letter-spacing:0.05em;">Technology
          Evidence</div>
        <h3 id="evidence-title" style="margin:0.25rem 0 0 0; font-size:1.1rem;">Tech Name</h3>
      </div>
      <button id="evidence-close" class="icon-btn" aria-label="Close" style="width:28px;height:28px;">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <div id="evidence-content" class="ev-content"></div>
  </div>
</dialog>
<dialog id="assign-dialog">
  <article style="max-width:400px;">
    <header>
      <h5 style="margin:0;">Assign Grup</h5>
    </header>
    <p class="small mono" id="assign-domain"></p>
    <select id="assign-select"></select>
    <footer style="margin-top:1rem; display:flex; gap:.5rem; justify-content:flex-end;">
      <button id="assign-cancel" class="secondary">Batal</button>
      <button id="assign-save" class="contrast">Simpan</button>
    </footer>
  </article>
</dialog>
</div>
<!-- removed modal groups-dialog; replaced by inline popover -->
{% endblock %}
{% block scripts %}
<script src="{{ url_for('static', filename='js/websites.js') }}"></script>
{% endblock %}